<!doctype html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Job Applications</title>
    <link rel="stylesheet" th:href="@{/style.css(v=${#dates.createNow().time})}">
</head>

<body>

<header class="topbar">
    <h1>Job Applications</h1>
    <button id="openModalBtn" type="button" class="btn">Add Job</button>
</header>
<section class="filters">
    <label class="filter-item">
        Status
        <select id="statusFilter">
            <option value="ALL">ALL</option>
            <option value="APPLIED">APPLIED</option>
            <option value="INTERVIEW">INTERVIEW</option>
            <option value="OFFER">OFFER</option>
            <option value="REJECTED">REJECTED</option>
        </select>
    </label>

    <label class="filter-item">
        Company
        <input id="companyFilter" type="text" placeholder="Search by company..." autocomplete="off">
    </label>
</section>
<div class="table-wrap">
    <table class="jobs-table">
        <thead>
        <tr>
            <th class="col-company">Company</th>
            <th class="col-position">Position</th>
            <th class="col-status">Status</th>
            <th class="col-date">Applied Date</th>
            <th class="col-notes">Notes</th>
            <th class="col-actions">Actions</th>
        </tr>
        </thead>

        <tbody id="jobsTbody">
        <tr th:each="j : ${jobs}"
            th:classappend="' status-' + ${#strings.toLowerCase(j.status)}">
            <td th:text="${j.company}"></td>
            <td th:text="${j.position}"></td>
            <td th:text="${j.status}"></td>
            <td th:text="${j.appliedDate}"></td>

            <td class="notes-cell">
                <button
                        type="button"
                        class="notes-preview"
                        th:if="${j.notes != null and !#strings.isEmpty(j.notes)}"
                        th:attr="data-notes=${j.notes}"
                        th:text="${j.notes}"
                        onclick="openNotesPopover(this)">
                </button>
            </td>

            <td class="actions-cell">
                <button
                        type="button"
                        class="btn btn-small"
                        th:attr="
                            data-id=${j.id},
                            data-company=${j.company},
                            data-position=${j.position},
                            data-status=${j.status},
                            data-appliedDate=${j.appliedDate},
                            data-notes=${j.notes}
                        "
                        onclick="editJob(this)">
                    Edit
                </button>

                <form
                        th:action="@{'/jobs/' + ${j.id} + '/delete'}"
                        method="post"
                        onsubmit="return confirm('Delete this job?');">
                    <button type="submit" class="btn btn-small btn-danger">Delete</button>
                </form>
            </td>
        </tr>
        </tbody>
    </table>
</div>

<!-- Modal overlay -->
<div id="modalOverlay" class="modal-overlay hidden" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
        <div class="modal-header">
            <h2 id="modalTitle">Add Job</h2>
            <button id="closeModalBtn" class="icon-btn" type="button" aria-label="Close">âœ•</button>
        </div>

        <form id="jobForm" autocomplete="off" th:action="@{/jobs}" th:object="${job}" method="post" class="modal-body">
            <label>
                Company
                <input type="text" th:field="*{company}" required>
            </label>

            <label>
                Position
                <input type="text" th:field="*{position}" required>
            </label>

            <label>
                Status
                <select th:field="*{status}" required>
                    <option value="APPLIED">APPLIED</option>
                    <option value="INTERVIEW">INTERVIEW</option>
                    <option value="OFFER">OFFER</option>
                    <option value="REJECTED">REJECTED</option>
                </select>
            </label>

            <label>
                Applied Date
                <input type="date" th:field="*{appliedDate}" min="1900-01-01" max="9999-12-31" >
            </label>

            <label>
                Notes
                <textarea th:field="*{notes}" rows="4"></textarea>
            </label>

            <div class="modal-footer">
                <button id="cancelBtn" type="button" class="btn">Cancel</button>
                <button type="submit" class="btn btn-primary">Save</button>
            </div>
        </form>
    </div>
</div>

<script th:src="@{/app.js(v=${#dates.createNow().time})}"></script>
</body>
</html>
